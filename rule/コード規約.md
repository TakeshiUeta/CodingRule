# コーディング規約

## 1. コメントアウト
- Javadocに基づいたコメントアウト  
- コメントアウトの英数文字は原則半角  
  - 全角英数は検索性が低くなるため原則使用しない
- 冗長なコメントはNG。第三者が読んでも分かるように配慮し、簡潔に記載すること。

## 2. インデント
- コードの空白は4文字単位

## 3. クラス
- クラス名は大文字始まりのキャメルケース（例: `UserService`, `OrderController`）
- クラス名はそのクラスが担う責務を明確に示すようにする
- クラス名は略語は不可とする。(但しxxxKBNなど馴染みのあるものは可とする)
- クラス名は直感的でかつできるだけ簡潔にする（20文字以上になるような場合や馴染みのない単語が入る場合は要検討）
  - **例1:** `UserService` → ユーザー関連の操作を行うサービス  
  - **例2:** `EmployeesKgInfo` → 単位を付けると社員の体重情報を示すクラスと分かりやすい  
  - **例3:** `controlpower` → ❌ キャメルケースではない／抽象的すぎて不明瞭  
  - **例4:** `ChargerIngestCommitService` → ❌ "Ingest" は馴染みが無く長すぎる
- Entityクラスの命名は複数形を基本とする（例: `Orders`, `Products`）※責務により例外あり

## 4. フィールド
- フィールド名は小文字始まりのキャメルケース（例: `id`, `goTime`）
- フィールド名は直感的かつ簡潔に（15文字以上や馴染みのない単語は要検討）
- クラス名と同じ規則に準拠
- 「頭痛が痛い」的な冗長な命名は避ける（例: `User.userId` は冗長）
- boolean型は `is` / `has` / `can` / `should` などの接頭辞を使う
- 定数は全て大文字＋アンダースコア（例：`DEFAULT_TIMEOUT`）- Entityクラスのフィールドはprivateとし、カプセル化を必ず行う
- Entityクラスのコンストラクタ
  - 引数なしのコンストラクタを必ず定義
  - 全てのフィールドを引数に含めたコンストラクタを定義

```
例：JavaDocコメントは割愛
//クラス名は大文字始まりのキャメルケース
public class Result {
    //id
    private String id; //フィールド名は小文字始まりのキャメルケース
    //出勤時間
    private String goTime;
    //退勤時間
    private String outTime;
    //出勤フラグ
    private boolean isGoWork; // フラグは`is` / `has` / `can` / `should` などの接頭辞を使う
    //定時退勤時間
    private static final String ON_TIME = "18:00"; //定数は全て大文字＋アンダースコア

    //引数なしのコンストラクタを必ず定義
    public Result() {
    }

    //全てのフィールドを引数に含めたコンストラクタを定義
    public Result(
      String id, 
      String goTime,
      String outTime,
      boolean isGoWork
       ) {
      this.id = id;
      this.goTime = goTime;
      this.outTime = outTime;
      this.isGoWork = isGoWork;
    }
}    
```

## 5. 共通メソッド
- メインクラスやコントローラクラス等、実行クラスでの共通化は原則NG  
  - サービスクラスやハンドラクラスに定義し、責務の混同を避ける
- メソッドはオーバーロード禁止
  - 拡張性低下・可読性低下・実装ミス防止のため
  - 同一の責務で引数の型違い等による明確な意図がある場合は、要相談で許容可（レビュー必須）
- メソッドは一つの責務に限定  
  - 何の役割を担うかを明確にする事。
    - 例1；例外処理とログ出力処理を混同して共通化した  → ❌ 責務が混同してしまってるため何の処理を行うメソッドなのか分からない
    - 例2；ログ出力処理を共通化して例外処理共通化の中にそのメソッドを含めた → ✅ これはOK。但しやりすぎ注意。ネストが深くなるとコードを追いづらくなるため
- 共通化は最低3回以上使用される場合に限る  
  - それ未満は共通化しない  
  - 共通化時は承認とメリットの明示を行う
  - 共通化しすぎてコード追えない問題の防止
- メソッドは20行以内を目安にし、粒度を意識して分割

## 6. インポート
- 使用しているものだけをインポート  
  - IDEの自動整形で不要なインポートは削除

## 7. サービスクラスのインスタンス
- サービスインスタンスはクラス上層に定義し、必ず `@Autowired` を使用
- DIを行う際は、インターフェースを参照する  
  - 実装クラスの直接呼び出しは禁止

## 8. バッドリクエスト（バリデーション）
- エラーメッセージは必須
  - エラーの発生箇所を明確にする（例：`ユーザー名は必須入力です`）
- 発生タイミングでログを残し、メッセージも出力

## 9. 例外処理
- 必須例外を最低一つ定義、必要に応じて追加。その下に最大スコープの例外を定義
- 可能性のある行でtry,catchを行い、範囲を絞ること（tryブロックのスコープが広すぎると原因特定が困難になる）
- エラーメッセージは必須
  - エラーの発生箇所を明確にする（例：`ユーザー更新処理に失敗しました`）
- 発生タイミングでログを残し、メッセージも出力

```
例：DB読み取り時のみに範囲を絞り、ランタイムエラー（必須例外）を一つ、その他例外をキャッチ
※あくまで例です。このように実装するとは限りません。
  try {
      user = userRepository.findById(id);
  } catch (RunTimeException e) {
      log.error("status={} {}", status, "ユーザー情報の読み取りに失敗しました");
      log.error("{}",e);
  } catch (Exception e){
      log.error("status={} {}", status, "ユーザー情報の読み取りで不具合が発生しました。システム管理者に報告してください");
      log.error("unexpected error",e);
  }
```

## 10. ローカル変数
- 基本的にフィールドの規則に準拠（但しある程度の略語は可）
- 3回以上使用する場合はメソッド上層に定義
- それ未満なら直前に定義する
- 不要なローカル変数は残さない

## 11. ログ

### ログレベルの原則
- `System.out.println("メッセージ")；`等のログ出力は禁止（デバッグ工程ならOK）
- `error`: バッドリクエスト、業務例外、システム例外
- `info`: 正常業務処理、アプリ起動、SQL出力（最低限）

### 出力先
- コンソール・ログファイル両方（環境設定に準拠）

### 基本方針
- 本番でのトラブル調査に役立つ「必要最低限の有用なログ」のみ出力
- 冗長な起動ログ、DB接続ログなどは出力しない

---

### 11.1 異常発生時のログ出力ルール

#### ■ バッドリクエスト・業務例外（想定内エラー）

| 区分            | ログレベル | 出力フォーマット                             | Throwable |
|-----------------|------------|----------------------------------------------|-----------|
| バッドリクエスト | `error`    | `log.error("status={} {}", status, message);` | ❌        |
| 業務例外        | `error`    | `log.error("status={} {}", status, message);` | ❌        |

---

#### ■ システム例外（想定外の障害など）

| 区分         | ログレベル | 出力フォーマット                            | Throwable |
|--------------|------------|----------------------------------------------|-----------|
| 想定外の例外 | `error`    | `log.error("unexpected error", throwable);`  | ✅        |
| 通信／DB／API等のタイムアウト	| `error`    |`log.error("{}",throwable);` | ✅        |
---

### 11.2 正常処理時のログ出力ルール

#### ■ 業務処理完了ログ

| 区分         | ログレベル | 出力フォーマット                             | 備考                        |
|--------------|------------|----------------------------------------------|-----------------------------|
| 正常処理時   | `info`     | `log.info("status={} {}", status, message);` | メッセージは簡潔／冗長禁止 |

---

#### ■ アプリケーション起動時

| 区分       | ログレベル | 出力フォーマット                |
|------------|------------|---------------------------------|
| 起動成功   | `info`     | `log.info("Application started");` |

※ その他の起動ログ（バナー／Bean構成ログ等）は極力抑制

---

#### ■ SQLログ（MyBatis）

| 区分     | ログレベル | 出力内容              | 備考                     |
|----------|------------|-----------------------|--------------------------|
| SQL表示  | `info`     | MyBatisによる自動出力 | バインド値は出力しない |

---

## 12. リファクタリング
- 実装の仕上げとして行うが、早めに行った方が良い場合もあり
- 共通化する部分が多くなる場合は要相談。タスク分けしてリスケ

---

## 13. 最後に
コーディング規約は守れない人を責めるためのものではなく、チーム全体が一緒に成長するためのガイドラインです。  
規約は最初から完璧に守ることを期待するものではありません。少しずつ理解し、意識していくことが大切です。  
規約の目的は、コードの品質向上とメンテナンスの容易さを実現することです。  
それに向けて、みんなで協力していければ良いと思います。
